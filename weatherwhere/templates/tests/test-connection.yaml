apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: weatherwhere-test-connection
spec:
  project: default
  source:
    repoURL: https://github.com/WeatherWhere/backend-kubernetes.git
    path: weather
    targetRevision: v1
    helm:
      values:
        ingress:
          pathMappings:
            - path: /weather
              service: weatherservice
              port: 8080
            - path: /air
              service: airservice
              port: 8090
            - path: /tour
              service: tourservice
              port: 8070
        applications:
          - name: air
            image:
              repository: public.ecr.aws/a5p8o7q9/airservice
              tag: v56
            replicas: 2
            port: 8080
            servicePort: 8090
            servicePortName: airservice
            appLabel: air
          - name: weather
            image:
              repository: public.ecr.aws/a5p8o7q9/weatherservice
              tag: v61
            replicas: 2
            port: 8080
            servicePort: 8080
            servicePortName: weatherservice
            appLabel: weather
          - name: tour
            image:
              repository: public.ecr.aws/a5p8o7q9/tourservice
              tag: v19
            replicas: 2
            port: 8080
            servicePort: 8070
            servicePortName: tourservice
            appLabel: tour
  destination:
    server: https://kubernetes.default.svc
    namespace: test
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
